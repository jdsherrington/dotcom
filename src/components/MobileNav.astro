---
import ThemeDrawer from "@/components/ThemeDrawer.astro";
import { Icon } from "astro-icon/components";
---

<div class="mobile-nav-container">
	<div class="mobile-nav-backdrop"></div>
	<a class="mobile-nav-button page-top-button">
		<Icon class="page-top-icon" name="ui/page-top" />
	</a>
	<div class="mobile-nav-menu">
		<div class="mobile-nav-items">
			<a class="mobile-nav-button mobile-nav-link" href="/blog">Blog</a>
			<a class="mobile-nav-button mobile-nav-link" href="/projects"
				>Projects</a
			>
			<a class="mobile-nav-button mobile-nav-link" href="/resources"
				>Resources</a
			>
			<a
				class="mobile-nav-button mobile-nav-link mobile-theme-toggle"
				href="javascript:void(0)">Theme</a
			>
		</div>
		<ThemeDrawer />
		<a class="mobile-nav-button nav-menu-button">
			<Icon class="nav-menu-icon" name="ui/hamburger" />
			<Icon class="nav-menu-close" name="ui/close" />
		</a>
	</div>
</div>

<style is:global>
	.mobile-nav-container {
		@apply fixed bottom-0 right-0 z-[1000] inline-flex flex-col place-items-end gap-2 p-[calc(var(--guide-gutter)-0.25rem)];
	}

	.mobile-nav-backdrop {
		mask: radial-gradient(
			ellipse 100% 100% at 100% 100%,
			rgba(0, 0, 0, 1) 50%,
			rgba(0, 0, 0, 0) 100%
		);
		z-index: -2;
		@apply pointer-events-none absolute bottom-0 right-0 h-[calc(100%*3)] w-[calc(100%*3)];
	}

	.mobile-nav-backdrop::before {
		content: "";
		@apply absolute bottom-0 right-0 z-[-1] h-full w-full opacity-0 transition-opacity duration-200 ease-in-out sm:bg-background-secondary/75 md:bg-transparent;
	}

	.mobile-nav-container:has(.mobile-nav-items.open)
		.mobile-nav-backdrop::before {
		@apply opacity-100;
	}

	.page-top-button {
		@apply pointer-events-none flex aspect-square !h-14 !w-14 place-content-center place-items-center p-0 opacity-0 transition-all duration-300 ease-in-out sm:blur-none md:blur-md;
	}

	body.scrolled .page-top-button {
		@apply pointer-events-auto opacity-100 blur-none;
	}

	.mobile-nav-container:has(.mobile-nav-items.open) .page-top-button {
		@apply !pointer-events-none !opacity-0;
	}

	.page-top-icon {
		@apply h-7 w-7;
	}

	.mobile-nav-menu {
		@apply flex-col place-items-end sm:inline-flex md:hidden;
	}

	.mobile-nav-items {
		@apply pointer-events-none absolute bottom-12 right-[calc(var(--guide-gutter)-0.25rem)] z-50 mb-[calc(var(--guide-gutter)*2)] inline-flex translate-x-[150%] flex-col place-items-end gap-2 font-mono uppercase transition-all duration-300 ease-in-out;
	}

	.mobile-nav-items.open {
		@apply pointer-events-auto translate-x-0;
	}

	.mobile-nav-button {
		@apply relative inline-block w-min rounded border border-foreground/5 bg-background-midpoint px-4 py-3 text-right tracking-wider text-foreground/80 shadow-lg shadow-black/10 transition-all duration-300 ease-in-out;
	}

	.nav-menu-button {
		@apply flex aspect-square !h-14 !w-14 place-content-center place-items-center p-0;
	}

	.nav-menu-button svg {
		@apply absolute left-[50%] top-[50%] h-6 w-6 -translate-x-[50%] -translate-y-[50%] transition-all duration-300 ease-in-out;
	}

	.nav-menu-icon {
		@apply opacity-100 blur-none;
	}

	.mobile-nav-menu:has(.mobile-nav-items.open) .nav-menu-icon {
		@apply opacity-0 blur-sm;
	}

	.nav-menu-close {
		@apply opacity-0 blur-sm;
	}

	.mobile-nav-menu:has(.mobile-nav-items.open) .nav-menu-close {
		@apply opacity-100 blur-none;
	}

	.mobile-nav-menu .theme-drawer {
		@apply pointer-events-none absolute bottom-[calc(var(--guide-gutter)+7.75rem)] right-[calc(var(--guide-gutter)-0.25rem)] z-50 flex w-auto origin-top translate-x-[50%] translate-y-2 select-none flex-col rounded border border-foreground/10 font-mono uppercase opacity-0 transition-all duration-300 ease-in-out;
	}

	.mobile-nav-menu:has(.mobile-nav-items.open) .theme-drawer {
		@apply translate-x-0;
	}

	.mobile-nav-menu .theme-drawer::before {
		content: "";
		z-index: -1;
		@apply absolute h-full w-full rounded bg-background-midpoint shadow-lg shadow-black/10 transition-all duration-300 ease-in-out;
	}

	.mobile-nav-menu .theme-drawer.open {
		@apply pointer-events-auto translate-y-0 cursor-default opacity-100;
	}

	.mobile-nav-menu .theme-drawer li {
		@apply inline-flex w-full cursor-pointer flex-row place-content-center place-items-center gap-2.5 rounded-md p-2.5 transition-all duration-300 ease-in-out;
	}

	.mobile-nav-menu .theme-drawer li * {
		@apply fill-foreground/40 stroke-foreground/40 text-sm tracking-widest text-foreground/80;
	}

	.mobile-nav-menu:has(.theme-drawer.open)
		.mobile-nav-link:not(.mobile-theme-toggle) {
		@apply pointer-events-none opacity-0;
	}

	.mobile-nav-menu:has(.theme-drawer.open) .mobile-theme-toggle {
		@apply scale-95 text-foreground/50;
	}
</style>

<script>
	function scrollToTopButton() {
		const scrollButton = document.querySelector(".page-top-button");

		if (scrollButton) {
			scrollButton.addEventListener("click", () => {
				window.scrollTo({ top: 0, behavior: "smooth" });
			});
		}
	}

	scrollToTopButton();
	document.addEventListener("astro:after-swap", scrollToTopButton);
</script>

<script>
	function openNavMenu() {
		const menuButton = document.querySelector(
			".nav-menu-button",
		) as HTMLElement;
		const menuItems = document.querySelector(
			".mobile-nav-items",
		) as HTMLElement;
		const themeDrawer = document.querySelector(
			".mobile-nav-container .theme-drawer",
		) as HTMLElement;

		menuButton.addEventListener("click", () => {
			if (menuItems.classList.contains("open")) {
				menuItems.classList.remove("open");
				themeDrawer.classList.remove("open");
			} else {
				menuItems.classList.add("open");
			}
		});
	}
	openNavMenu();
	document.addEventListener("astro:after-swap", openNavMenu);
</script>

<script>
	function openMobileThemeDrawer() {
		const themeToggle = document.querySelector(
			".mobile-theme-toggle",
		) as HTMLElement;
		const themeDrawer = document.querySelector(
			".mobile-nav-container .theme-drawer",
		) as HTMLElement;

		themeToggle.addEventListener("click", () => {
			if (themeDrawer.classList.contains("open")) {
				themeDrawer.classList.remove("open");
			} else {
				themeDrawer.classList.add("open");
			}
		});
	}
	openMobileThemeDrawer();
	document.addEventListener("astro:after-swap", openMobileThemeDrawer);
</script>

<script data-astro-rerun>
	document.addEventListener("click", (e) => {
		if (
			!document.querySelector(".mobile-nav-menu").contains(e.target) &&
			document
				.querySelector(".mobile-nav-items")
				.classList.contains("open")
		) {
			document
				.querySelector(".mobile-nav-items")
				.classList.remove("open");
			document
				.querySelector(".mobile-nav-container .theme-drawer")
				.classList.remove("open");
		}
	});
</script>
